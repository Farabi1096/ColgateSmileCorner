<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>কোলগেট স্মাইল কর্ণার - ফর্ম</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Noto Sans Bengali for better Bangla rendering -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Noto+Sans+Bengali:wght@400;600&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Noto Sans Bengali', 'Inter', sans-serif;
            background-color: #f3f4f6;
            /* Red themed gradient for Colgate */
            background-image: 
                radial-gradient(at 0% 0%, hsla(0, 72%, 90%, 1) 0, transparent 50%), 
                radial-gradient(at 50% 0%, hsla(0, 80%, 95%, 1) 0, transparent 50%), 
                radial-gradient(at 100% 0%, hsla(350, 80%, 90%, 1) 0, transparent 50%);
            background-size: cover;
            min-height: 100vh;
        }
        
        /* Custom loading spinner animation */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #dc2626; /* Red spinner */
            width: 24px;
            height: 24px;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .input-group:focus-within label {
            color: #dc2626; /* Red focus label */
        }
        
        .input-group:focus-within i {
            color: #dc2626; /* Red focus icon */
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">

    <!-- Form Container -->
    <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden transform transition-all hover:scale-[1.01] duration-300">
        
        <!-- Header -->
        <div class="bg-red-600 p-8 text-center relative overflow-hidden">
            <!-- Decorative background shape -->
            <div class="absolute top-0 left-0 w-full h-full bg-red-700 opacity-20 transform -skew-y-6 origin-top-left"></div>
            
            <h2 class="text-2xl font-bold text-white relative z-10">কোলগেট স্মাইল কর্ণার</h2>
            <p class="text-red-100 mt-2 relative z-10 text-sm">
                এই ফর্মটি কোলগেট পালমোলিভ এর বিশেষ প্রোগ্রাম "কোলগেট স্মাইল কর্ণার" এর জন্য নির্ধারিত দোকান গুলোর ছবি সংগ্রহের জন্য তৈরী করা হয়েছে
            </p>
        </div>

        <!-- Form Content -->
        <div class="p-6 sm:p-8">
            <form id="customForm" class="space-y-5">
                
                <!-- Field 1: Display Month -->
                <div class="input-group relative">
                    <label class="block text-sm font-semibold text-gray-700 mb-1 transition-colors">
                        ডিসপ্লে মাস <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i data-lucide="calendar" class="h-5 w-5 text-gray-400 transition-colors"></i>
                        </div>
                        <select name="display_month" required
                            class="pl-10 block w-full rounded-lg border-gray-300 bg-gray-50 border focus:border-red-500 focus:ring-2 focus:ring-red-200 focus:bg-white text-gray-900 sm:text-sm py-3 transition-all outline-none appearance-none">
                            <option value="" disabled selected>ডিসপ্লের নির্ধারিত মাস সিলেক্ট করুন</option>
                            <option value="November">November</option>
                            <option value="December">December</option>
                        </select>
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <i data-lucide="chevron-down" class="h-4 w-4 text-gray-400"></i>
                        </div>
                    </div>
                </div>

                <!-- Field: Area Name -->
                <div class="input-group relative">
                    <label class="block text-sm font-semibold text-gray-700 mb-1 transition-colors">
                        এরিয়া নাম <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i data-lucide="map-pin" class="h-5 w-5 text-gray-400 transition-colors"></i>
                        </div>
                        <select name="area_name" id="areaSelect" required
                            class="pl-10 block w-full rounded-lg border-gray-300 bg-gray-50 border focus:border-red-500 focus:ring-2 focus:ring-red-200 focus:bg-white text-gray-900 sm:text-sm py-3 transition-all outline-none appearance-none">
                            <option value="" disabled selected>এরিয়া সিলেক্ট করুন</option>
                            <option value="CTG">CTG</option>
                            <option value="DHAKA">DHAKA</option>
                        </select>
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <i data-lucide="chevron-down" class="h-4 w-4 text-gray-400"></i>
                        </div>
                    </div>
                </div>

                <!-- Field 2: Distribution Name -->
                <div class="input-group relative">
                    <label class="block text-sm font-semibold text-gray-700 mb-1 transition-colors">
                        ডিস্ট্রিবিউশন নাম <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i data-lucide="truck" class="h-5 w-5 text-gray-400 transition-colors"></i>
                        </div>
                        <select name="distribution_name" id="distSelect" required
                            class="pl-10 block w-full rounded-lg border-gray-300 bg-gray-50 border focus:border-red-500 focus:ring-2 focus:ring-red-200 focus:bg-white text-gray-900 sm:text-sm py-3 transition-all outline-none appearance-none">
                            <option value="" disabled selected>প্রথমে এরিয়া সিলেক্ট করুন</option>
                            <!-- Options will be populated by JavaScript -->
                        </select>
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <i data-lucide="chevron-down" class="h-4 w-4 text-gray-400"></i>
                        </div>
                    </div>
                </div>

                <!-- Field 3: Slab -->
                <div class="input-group relative">
                    <label class="block text-sm font-semibold text-gray-700 mb-1 transition-colors">
                        স্ল্যাব <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i data-lucide="layers" class="h-5 w-5 text-gray-400 transition-colors"></i>
                        </div>
                        <select name="slab" required
                            class="pl-10 block w-full rounded-lg border-gray-300 bg-gray-50 border focus:border-red-500 focus:ring-2 focus:ring-red-200 focus:bg-white text-gray-900 sm:text-sm py-3 transition-all outline-none appearance-none">
                            <option value="" disabled selected>দোকানটি যে স্লাবটিতে সম্মতি প্রকাশ করেছে</option>
                            <option value="Slab 1">Slab 1</option>
                            <option value="Slab 2">Slab 2</option>
                        </select>
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <i data-lucide="chevron-down" class="h-4 w-4 text-gray-400"></i>
                        </div>
                    </div>
                </div>

                <!-- Field 4: Shop Code -->
                <div class="input-group relative">
                    <label class="block text-sm font-semibold text-gray-700 mb-1 transition-colors">
                        দোকানের কোড <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i data-lucide="hash" class="h-5 w-5 text-gray-400 transition-colors"></i>
                        </div>
                        <input type="text" name="shop_code" required
                            class="pl-10 block w-full rounded-lg border-gray-300 bg-gray-50 border focus:border-red-500 focus:ring-2 focus:ring-red-200 focus:bg-white text-gray-900 sm:text-sm py-3 transition-all outline-none uppercase" 
                            placeholder="BDC0002362">
                    </div>
                    <p class="text-xs text-gray-500 mt-1">উদাহরণ: BDC0002362</p>
                </div>

                <!-- Field 5: Shop Image Upload -->
                <div class="input-group relative">
                    <label class="block text-sm font-semibold text-gray-700 mb-1 transition-colors">
                        ডিসপ্লের ছবি <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i data-lucide="image" class="h-5 w-5 text-gray-400 transition-colors"></i>
                        </div>
                        <input type="file" id="shop_image" name="shop_image" required accept="image/*"
                            class="pl-10 block w-full rounded-lg border-gray-300 bg-gray-50 border focus:border-red-500 focus:ring-2 focus:ring-red-200 focus:bg-white text-gray-900 sm:text-sm py-3 transition-all outline-none file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-50 file:text-red-700 hover:file:bg-red-100">
                    </div>
                    <p class="text-xs text-gray-500 mt-1">ডিসপ্লের একটি পরিষ্কার ছবি আপলোড করুন।</p>
                </div>

                <!-- Submit Button -->
                <button type="submit" id="submitBtn"
                    class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-bold text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-all duration-200 transform hover:-translate-y-0.5">
                    <span id="btnText">জমা দিন (Submit)</span>
                    <div id="btnLoader" class="loader hidden"></div>
                </button>

            </form>

            <!-- Success Message (Hidden by default) -->
            <div id="successMessage" class="hidden text-center py-4 animate-fade-in">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
                    <i data-lucide="check" class="h-6 w-6 text-green-600"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-900">সফলভাবে জমা দেওয়া হয়েছে!</h3>
                <p class="text-sm text-gray-500 mt-2">আমরা আপনার তথ্য পেয়েছি।</p>
                <button onclick="resetForm()" class="mt-4 text-red-600 hover:text-red-800 text-sm font-medium">আরেকটি ফর্ম পূরণ করুন</button>
            </div>
            
            <!-- Error Message (Hidden by default) -->
             <div id="errorMessage" class="hidden text-center py-4 text-red-600 text-sm">
                কিছু ভুল হয়েছে। অনুগ্রহ করে আবার চেষ্টা করুন।
            </div>

        </div>
        
        <!-- Footer -->
        <div class="bg-gray-50 px-8 py-4 border-t border-gray-100">
            <p class="text-xs text-center text-gray-400">কোলগেট স্মাইল কর্ণার প্রোগ্রাম &copy; ২০২৫</p>
        </div>
    </div>

    <script>
        // Initialize Icons
        lucide.createIcons();

        const form = document.getElementById('customForm');
        const submitBtn = document.getElementById('submitBtn');
        const btnText = document.getElementById('btnText');
        const btnLoader = document.getElementById('btnLoader');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        
        // Data for Area to Distribution mapping
        const distributionData = {
            "CTG": [
                "Next Associates",
                "ARC Trading",
                "M/S Farid Enterprise",
                "P M Traders",
                "Madina Traders"
            ],
            "DHAKA": [
                "Takwa Enterprise",
                "Unitrust Trading Co.",
                "Paragon Marketing Limited",
                "Self Tech Marketing Ltd",
                "M/S Sanuar Enterprise",
                "M/S Hasan Brothers Corporation",
                "M/S Hasan Brothers Corporation 2"
            ]
        };

        const areaSelect = document.getElementById('areaSelect');
        const distSelect = document.getElementById('distSelect');

        // Event Listener for Area Change
        areaSelect.addEventListener('change', function() {
            const selectedArea = this.value;
            const distributors = distributionData[selectedArea] || [];
            
            // Clear existing options
            distSelect.innerHTML = '<option value="" disabled selected>দোকানটি যে ডিস্ট্রিবিউশন এর অধীনে তা সিলেক্ট করুন</option>';
            
            // Add new options based on area
            distributors.forEach(dist => {
                const option = document.createElement('option');
                option.value = dist;
                option.textContent = dist;
                distSelect.appendChild(option);
            });
        });

        // IMPORTANT: Replace this URL with your Google Web App URL after deploying the backend code
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx9WuBOgKRgfol24Def7xKGwUHu6zfJPhdpuwqlE58yWgraHM7uXKpJlCmwa4HCKqNW/exec';

        // Helper function to convert file to Base64 string
        const fileToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        };

        form.addEventListener('submit', async e => {
            e.preventDefault();
            
            // UI Loading State
            btnText.classList.add('hidden');
            btnLoader.classList.remove('hidden');
            submitBtn.disabled = true;
            submitBtn.classList.add('opacity-75', 'cursor-not-allowed');

            // Collect Data
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            // Handle File Upload process
            const fileInput = document.getElementById('shop_image');
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                try {
                    // Convert file to Base64 before sending
                    const base64File = await fileToBase64(file);
                    // Replace the file object with the image data structure
                    data.shop_image = {
                        name: file.name,
                        type: file.type,
                        data: base64File
                    };
                } catch (error) {
                    console.error("Error converting file:", error);
                    showError();
                    return; // Stop submission if file conversion fails
                }
            }

            // --- REAL SUBMISSION MODE ---
            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(data),
                mode: 'no-cors' 
            })
            .then(() => {
                showSuccess();
            })
            .catch(error => {
                console.error('Error:', error);
                showError();
            });
        });

        function showSuccess() {
            form.classList.add('hidden');
            successMessage.classList.remove('hidden');
            btnLoader.classList.add('hidden');
            btnText.classList.remove('hidden');
        }

        function showError() {
            errorMessage.classList.remove('hidden');
            btnLoader.classList.add('hidden');
            btnText.classList.remove('hidden');
            submitBtn.disabled = false;
            submitBtn.classList.remove('opacity-75', 'cursor-not-allowed');
        }

        function resetForm() {
            form.reset();
            successMessage.classList.add('hidden');
            form.classList.remove('hidden');
            submitBtn.disabled = false;
            submitBtn.classList.remove('opacity-75', 'cursor-not-allowed');
            errorMessage.classList.add('hidden');
            
            // Reset dropdowns
            distSelect.innerHTML = '<option value="" disabled selected>প্রথমে এরিয়া সিলেক্ট করুন</option>';
        }
    </script>
</body>
</html>
